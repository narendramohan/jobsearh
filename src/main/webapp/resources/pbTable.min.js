function filtrarTabla(e,t){if(t!=undefined)e.val(t);var n=e.attr("search-in");if(e.val()===""){$("#"+n+" tbody>tr").show()}else{$("#"+n+" tbody>tr").hide();$("#"+n+" td:contains-ci('"+e.val()+"')").parent("tr").show()}}function addButton(e,t){$("#"+e.attr("id")+'-pbToolbar div[name="sectionForButtons"]').append(t)}function onView(){options.onView.call(this)}function onEdit(){options.onEdit.call(this)}function onDelete(){options.onDelete.call(this)}function onNew(){options.onNew.call(this)}function onPrint(){options.onPrint.call(this)}function onReceipt(){options.onReceipt.call(this)}function pbSortable(){function n(e,t,r){if(e.addEventListener){e.addEventListener(t,r,false)}else{if(!r.$$guid)r.$$guid=n.guid++;if(!e.events)e.events={};var s=e.events[t];if(!s){s=e.events[t]={};if(e["on"+t]){s[0]=e["on"+t]}}s[r.$$guid]=r;e["on"+t]=i}}function r(e,t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}else{if(e.events&&e.events[t]){delete e.events[t][n.$$guid]}}}function i(e){var t=true;e=e||s(((this.ownerDocument||this.document||this).parentWindow||window).event);var n=this.events[e.type];for(var r in n){this.$$handleEvent=n[r];if(this.$$handleEvent(e)===false){t=false}}return t}function s(e){e.preventDefault=s.preventDefault;e.stopPropagation=s.stopPropagation;return e}var e=false;sorttable={init:function(){if(arguments.callee.done)return;arguments.callee.done=true;if(t)clearInterval(t);if(!document.createElement||!document.getElementsByTagName)return;sorttable.DATE_RE=/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/;o(document.getElementsByTagName("table"),function(e){if(e.className.search(/\bsortable\b/)!=-1){sorttable.makeSortable(e)}})},makeSortable:function(t){if(t.getElementsByTagName("thead").length==0){the=document.createElement("thead");the.appendChild(t.rows[0]);t.insertBefore(the,t.firstChild)}if(t.tHead==null)t.tHead=t.getElementsByTagName("thead")[0];if(t.tHead.rows.length!=1)return;sortbottomrows=[];for(var r=0;r<t.rows.length;r++){if(t.rows[r].className.search(/\bsortbottom\b/)!=-1){sortbottomrows[sortbottomrows.length]=t.rows[r]}}if(sortbottomrows){if(t.tFoot==null){tfo=document.createElement("tfoot");t.appendChild(tfo)}for(var r=0;r<sortbottomrows.length;r++){tfo.appendChild(sortbottomrows[r])}delete sortbottomrows}headrow=t.tHead.rows[0].cells;for(var r=0;r<headrow.length;r++){if(!headrow[r].className.match(/\bsorttable_nosort\b/)){mtch=headrow[r].className.match(/\bsorttable_([a-z0-9]+)\b/);if(mtch){override=mtch[1]}if(mtch&&typeof sorttable["sort_"+override]=="function"){headrow[r].sorttable_sortfunction=sorttable["sort_"+override]}else{headrow[r].sorttable_sortfunction=sorttable.guessType(t,r)}headrow[r].sorttable_columnindex=r;headrow[r].sorttable_tbody=t.tBodies[0];n(headrow[r],"click",sorttable.innerSortFunction=function(t){if(this.className.search(/\bsorttable_sorted\b/)!=-1){sorttable.reverse(this.sorttable_tbody);this.className=this.className.replace("sorttable_sorted","sorttable_sorted_reverse");this.removeChild(document.getElementById("sorttable_sortfwdind"));sortrevind=document.createElement("span");sortrevind.id="sorttable_sortrevind";sortrevind.innerHTML=e?'&nbsp<font face="webdings">5</font>':"&nbsp;&#x25B4;";this.appendChild(sortrevind);return}if(this.className.search(/\bsorttable_sorted_reverse\b/)!=-1){sorttable.reverse(this.sorttable_tbody);this.className=this.className.replace("sorttable_sorted_reverse","sorttable_sorted");this.removeChild(document.getElementById("sorttable_sortrevind"));sortfwdind=document.createElement("span");sortfwdind.id="sorttable_sortfwdind";sortfwdind.innerHTML=e?'&nbsp<font face="webdings">6</font>':"&nbsp;&#x25BE;";this.appendChild(sortfwdind);return}theadrow=this.parentNode;o(theadrow.childNodes,function(e){if(e.nodeType==1){e.className=e.className.replace("sorttable_sorted_reverse","");e.className=e.className.replace("sorttable_sorted","")}});sortfwdind=document.getElementById("sorttable_sortfwdind");if(sortfwdind){sortfwdind.parentNode.removeChild(sortfwdind)}sortrevind=document.getElementById("sorttable_sortrevind");if(sortrevind){sortrevind.parentNode.removeChild(sortrevind)}this.className+=" sorttable_sorted";sortfwdind=document.createElement("span");sortfwdind.id="sorttable_sortfwdind";sortfwdind.innerHTML=e?'&nbsp<font face="webdings">6</font>':"&nbsp;&#x25BE;";this.appendChild(sortfwdind);row_array=[];col=this.sorttable_columnindex;rows=this.sorttable_tbody.rows;for(var n=0;n<rows.length;n++){row_array[row_array.length]=[sorttable.getInnerText(rows[n].cells[col]),rows[n]]}row_array.sort(this.sorttable_sortfunction);tb=this.sorttable_tbody;for(var n=0;n<row_array.length;n++){tb.appendChild(row_array[n][1])}delete row_array})}}},guessType:function(e,t){sortfn=sorttable.sort_alpha;for(var n=0;n<e.tBodies[0].rows.length;n++){text=sorttable.getInnerText(e.tBodies[0].rows[n].cells[t]);if(text!=""){if(text.match(/^-?[£$¤]?[\d,.]+%?$/)){return sorttable.sort_numeric}possdate=text.match(sorttable.DATE_RE);if(possdate){first=parseInt(possdate[1]);second=parseInt(possdate[2]);if(first>12){return sorttable.sort_ddmm}else if(second>12){return sorttable.sort_mmdd}else{sortfn=sorttable.sort_ddmm}}}}return sortfn},getInnerText:function(e){if(!e)return"";hasInputs=typeof e.getElementsByTagName=="function"&&e.getElementsByTagName("input").length;if(e.getAttribute("sorttable_customkey")!=null){return e.getAttribute("sorttable_customkey")}else if(typeof e.textContent!="undefined"&&!hasInputs){return e.textContent.replace(/^\s+|\s+$/g,"")}else if(typeof e.innerText!="undefined"&&!hasInputs){return e.innerText.replace(/^\s+|\s+$/g,"")}else if(typeof e.text!="undefined"&&!hasInputs){return e.text.replace(/^\s+|\s+$/g,"")}else{switch(e.nodeType){case 3:if(e.nodeName.toLowerCase()=="input"){return e.value.replace(/^\s+|\s+$/g,"")};case 4:return e.nodeValue.replace(/^\s+|\s+$/g,"");break;case 1:case 11:var t="";for(var n=0;n<e.childNodes.length;n++){t+=sorttable.getInnerText(e.childNodes[n])}return t.replace(/^\s+|\s+$/g,"");break;default:return""}}},reverse:function(e){newrows=[];for(var t=0;t<e.rows.length;t++){newrows[newrows.length]=e.rows[t]}for(var t=newrows.length-1;t>=0;t--){e.appendChild(newrows[t])}delete newrows},sort_numeric:function(e,t){aa=parseFloat(e[0].replace(/[^0-9.-]/g,""));if(isNaN(aa))aa=0;bb=parseFloat(t[0].replace(/[^0-9.-]/g,""));if(isNaN(bb))bb=0;return aa-bb},sort_alpha:function(e,t){if(e[0]==t[0])return 0;if(e[0]<t[0])return-1;return 1},sort_ddmm:function(e,t){mtch=e[0].match(sorttable.DATE_RE);y=mtch[3];m=mtch[2];d=mtch[1];if(m.length==1)m="0"+m;if(d.length==1)d="0"+d;dt1=y+m+d;mtch=t[0].match(sorttable.DATE_RE);y=mtch[3];m=mtch[2];d=mtch[1];if(m.length==1)m="0"+m;if(d.length==1)d="0"+d;dt2=y+m+d;if(dt1==dt2)return 0;if(dt1<dt2)return-1;return 1},sort_mmdd:function(e,t){mtch=e[0].match(sorttable.DATE_RE);y=mtch[3];d=mtch[2];m=mtch[1];if(m.length==1)m="0"+m;if(d.length==1)d="0"+d;dt1=y+m+d;mtch=t[0].match(sorttable.DATE_RE);y=mtch[3];d=mtch[2];m=mtch[1];if(m.length==1)m="0"+m;if(d.length==1)d="0"+d;dt2=y+m+d;if(dt1==dt2)return 0;if(dt1<dt2)return-1;return 1},shaker_sort:function(e,t){var n=0;var r=e.length-1;var i=true;while(i){i=false;for(var s=n;s<r;++s){if(t(e[s],e[s+1])>0){var o=e[s];e[s]=e[s+1];e[s+1]=o;i=true}}r--;if(!i)break;for(var s=r;s>n;--s){if(t(e[s],e[s-1])<0){var o=e[s];e[s]=e[s-1];e[s-1]=o;i=true}}n++}}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",sorttable.init,false)}if(/WebKit/i.test(navigator.userAgent)){var t=setInterval(function(){if(/loaded|complete/.test(document.readyState)){sorttable.init()}},10)}window.onload=sorttable.init;n.guid=1;s.preventDefault=function(){this.returnValue=false};s.stopPropagation=function(){this.cancelBubble=true};if(!Array.forEach){Array.forEach=function(e,t,n){for(var r=0;r<e.length;r++){t.call(n,e[r],r,e)}}}Function.prototype.forEach=function(e,t,n){for(var r in e){if(typeof this.prototype[r]=="undefined"){t.call(n,e[r],r,e)}}};String.forEach=function(e,t,n){Array.forEach(e.split(""),function(r,i){t.call(n,r,i,e)})};var o=function(e,t,n){if(e){var r=Object;if(e instanceof Function){r=Function}else if(e.forEach instanceof Function){e.forEach(t,n);return}else if(typeof e=="string"){r=String}else if(typeof e.length=="number"){r=Array}r.forEach(e,t,n)}}}(function(e){e.fn.pbTable=function(t){var n={selectable:true,sortable:true,toolbar:{enabled:true,filterBox:true,tags:[{display:"Todos",toSearch:""}],buttons:["view","edit","delete","new","print","receipt"]}};options=jQuery.extend(true,n,t);var r=e(this);var i='<input id="search-tablaDatos" search-in="tablaDatos" type="search" class="form-control" placeholder="Buscar...">';var s='<button id="btn-View" class="btn btn-success">Ver</button>';var o='<button id="btn-Edit" class="btn btn-warning">Editar</button>';var u='<button id="btn-Delete" class="btn btn-danger">Eliminar</button>';var a='<button id="btn-New" class="btn btn-primary">Nuevo</button>';var f='<button id="btn-Print" class="btn btn-primary">Print</button>';var l='<button id="btn-Receipt" class="btn btn-primary">Recibo</button>';var c='<div id="'+r.attr("id")+"-pbToolbar"+'" class="row">';c+='<div name="sectionForSearchBox" class="col-lg-3"></div>';c+='<div name="sectionForTags" class="col-lg-4"></div>';c+='<div name="sectionForButtons" class="col-lg-5 text-right"></div>';c+="</div><br>";if(options.selectable){e(this).children("tbody").css("cursor","pointer");e(this).children("tbody").children("tr").on("click",function(){if(e(this).hasClass("warning"))var t=1;r.children("tbody").children("tr").removeClass("warning");if(t!=1)e(this).addClass("warning")})}if(options.sortable){r.addClass("sortable");e("#"+r.attr("id")+" thead").css("cursor","pointer");pbSortable()}if(options.toolbar.enabled){r.before(c);if(options.toolbar.filterBox){e("#"+r.attr("id")+'-pbToolbar div[name="sectionForSearchBox"]').append(i)}if(options.toolbar.tags.length>0&&options.toolbar.filterBox){if(t.toolbar!==undefined&&t.toolbar.tags!==undefined)options.toolbar.tags=t.toolbar.tags;options.toolbar.tags.forEach(function(t){e("#"+r.attr("id")+'-pbToolbar div[name="sectionForTags"]').append('<button name="pbButtonTag" class="btn btn-link" input-search="search-'+r.attr("id")+'" toSearch="'+t.toSearch+'">'+t.display+"</button>")});e('button[name="pbButtonTag"]').click(function(t){var n=e("#"+e(this).attr("input-search"));var r=e(this).attr("toSearch");filtrarTabla(n,r)})}if(options.toolbar.buttons.length>0&&options.toolbar.filterBox){if(t.toolbar!==undefined&&t.toolbar.buttons!==undefined)options.toolbar.buttons=t.toolbar.buttons;options.toolbar.buttons.forEach(function(t){switch(t){case"view":addButton(r,s);e("#btn-View").bind("click",onView);break;case"edit":addButton(r,o);e("#btn-Edit").bind("click",onEdit);break;case"delete":addButton(r,u);e("#btn-Delete").bind("click",onDelete);break;case"new":addButton(r,a);e("#btn-New").bind("click",onNew);break;case"print":addButton(r,f);e("#btn-Print").bind("click",onPrint);break;case"receipt":addButton(r,l);e("#btn-Receipt").bind("click",onReceipt);break}})}e("input[search-in]").keyup(function(){filtrarTabla(e(this))})}}})(jQuery);$.extend($.expr[":"],{"contains-ci":function(e,t,n,r){return(e.textContent||e.innerText||$(e).text()||"").toLowerCase().indexOf((n[3]||"").toLowerCase())>=0}})
